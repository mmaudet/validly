---
milestone: "1.1"
audited: 2026-02-20
status: gaps_found
scores:
  requirements: 35/39
  phases: 3/3
  integration: 31/35
  flows: 5/7
gaps:
  requirements:
    - id: "COMM-02"
      status: "unsatisfied"
      phase: "Phase 14"
      claimed_by_plans: ["14-01-PLAN.md", "14-02-PLAN.md"]
      completed_by_plans: ["14-01-SUMMARY.md", "14-02-SUMMARY.md"]
      verification_status: "missing"
      evidence: "GET /api/workflows/:id/comments returns array, but CommentThread.tsx reads data.comments (undefined on array). Thread always shows 'No comments yet'."
    - id: "COMM-01"
      status: "partial"
      phase: "Phase 14"
      claimed_by_plans: ["14-01-PLAN.md", "14-02-PLAN.md"]
      completed_by_plans: ["14-01-SUMMARY.md", "14-02-SUMMARY.md"]
      verification_status: "missing"
      evidence: "POST works (comment created in DB), but GET display broken — users can post but cannot see comments."
    - id: "ERR-06"
      status: "partial"
      phase: "Phase 13"
      claimed_by_plans: ["13-05-PLAN.md"]
      completed_by_plans: ["13-05-SUMMARY.md"]
      verification_status: "missing"
      evidence: "mapApiError function exists in api.ts but is never imported or called. API errors display as raw English strings."
    - id: "RESP-06"
      status: "partial"
      phase: "Phase 15"
      claimed_by_plans: ["15-01-PLAN.md"]
      completed_by_plans: ["15-01-SUMMARY.md"]
      verification_status: "missing"
      evidence: "MobileNav hamburger menu only on DashboardPage and AdminUsersPage. Missing from WorkflowDetailPage, TemplateFormPage, ProfilePage."
  integration:
    - from: "comment-service.ts"
      to: "NotificationCenter.tsx"
      issue: "COMMENT_ADDED notification context stores 'authorEmail' but frontend reads 'commentAuthor'. Author name always empty in notification display."
      affected_requirements: ["NOTIF-05"]
  flows:
    - name: "Workflow comments"
      breaks_at: "CommentThread GET response parsing"
      details: "API returns Comment[] array, frontend reads .comments property (undefined). Thread always empty."
      affected_requirements: ["COMM-01", "COMM-02"]
    - name: "Mobile navigation"
      breaks_at: "WorkflowDetailPage, TemplateFormPage, ProfilePage headers"
      details: "No hamburger menu on 3 of 5 authenticated pages. Users must navigate back to dashboard to access nav."
      affected_requirements: ["RESP-06"]
tech_debt:
  - phase: 13-foundation
    items:
      - "mapApiError exported but never used — dead code"
      - "reply.status(400 as any) cast in auth routes (Fastify type limitation)"
  - phase: 14-social-features
    items:
      - "COMMENT_ADDED notification context key mismatch (authorEmail vs commentAuthor) — benign because i18n template doesn't use {{commentAuthor}}"
  - phase: 15-polish-completion
    items:
      - "MobileNav only integrated on 2 of 5 authenticated pages"
      - "TemplateFormPage circuit builder tablet-minimum (768px+) by design — not mobile-friendly"
---

# Milestone v1.1 UX Polish — Audit Report

## Overview

| Metric | Score |
|--------|-------|
| Requirements | 35/39 satisfied |
| Phases | 3/3 completed |
| Integration wiring | 31/35 connected |
| E2E flows | 5/7 complete |
| Status | **gaps_found** |

## Critical Defects

### 1. Comment thread never displays (COMM-01, COMM-02) — CRITICAL

**File:** `backend/src/api/routes/comments.ts` line 30
**File:** `frontend/src/components/workflow/CommentThread.tsx` lines 19-22, 88

The backend returns a raw array from `GET /api/workflows/:id/comments`:
```ts
return reply.send(comments); // sends: [ { id, body, createdAt, author } ]
```

The frontend expects a wrapped object:
```ts
interface CommentsResponse { comments: Comment[] }
queryFn: () => apiFetch<CommentsResponse>(`/workflows/${workflowId}/comments`),
const comments = data?.comments ?? []; // data.comments is undefined on array → always []
```

**Impact:** Comment thread always shows "No comments yet" even when comments exist. POST works but GET display is broken.

**Fix:** Either wrap backend response in `{ comments }` or change frontend to treat response as `Comment[]` directly.

### 2. mapApiError never called (ERR-06) — MINOR

**File:** `frontend/src/lib/api.ts` line 54

`mapApiError` is exported but never imported or called anywhere. API error messages reach users as raw English strings instead of translated i18n messages.

**Fix:** Import and use `mapApiError` in error handlers, or accept as tech debt.

### 3. MobileNav missing from 3 pages (RESP-06) — MINOR

**Files:** `WorkflowDetailPage.tsx`, `TemplateFormPage.tsx`, `ProfilePage.tsx`

MobileNav hamburger menu only integrated on DashboardPage and AdminUsersPage. Three authenticated pages use back-links only — no access to full navigation on mobile.

**Fix:** Import and render `<MobileNav>` in the header of each page.

### 4. COMMENT_ADDED notification author field mismatch (NOTIF-05) — COSMETIC

**File:** `backend/src/services/comment-service.ts` line 106

Notification context stores `authorEmail` but `NotificationCenter.tsx` reads `metadata.commentAuthor`. Currently benign because the i18n template `notifications.comment_added` doesn't use `{{commentAuthor}}`.

**Fix:** Rename to `commentAuthor: author.name` in comment-service.ts context object.

## Requirements Coverage

### Satisfied (35/39)

| Category | Requirements | Status |
|----------|-------------|--------|
| AUTH (6) | AUTH-01..06 | All satisfied |
| PROF (4) | PROF-01..04 | All satisfied |
| DOCX (3) | DOCX-01..03 | All satisfied |
| NOTIF (6) | NOTIF-01..04, NOTIF-06, NOTIF-07 | All satisfied |
| COMM (3) | COMM-03, COMM-04, COMM-05 | All satisfied |
| ERR (5) | ERR-01..05 | All satisfied |
| RESP (5) | RESP-01..05 | All satisfied |
| I18N (2) | I18N-01, I18N-02 | All satisfied |

### Unsatisfied (4/39)

| Requirement | Description | Status | Issue |
|-------------|-------------|--------|-------|
| COMM-01 | Post comments on workflow detail | Partial | POST works, GET display broken |
| COMM-02 | Chronological thread display | Unsatisfied | Thread always empty due to response shape mismatch |
| ERR-06 | API errors mapped to user messages | Partial | mapApiError exists but never called |
| RESP-06 | Mobile-friendly navigation | Partial | Hamburger only on 2 of 5 pages |

## E2E Flow Results

| Flow | Status | Notes |
|------|--------|-------|
| Password reset | Complete | forgot → email → reset → login works end-to-end |
| Profile management | Complete | nav → profile → edit name/password/language/prefs |
| Workflow comments | **Broken** | POST creates comment, GET display broken |
| Notifications | Complete | action → notification → bell → panel → mark read |
| DOCX preview | Complete | upload → preview renders inline with DOMPurify |
| Error handling | Complete | 404, error boundary, form validation all work |
| Mobile navigation | **Partial** | Hamburger on dashboard only, not all pages |

## Phase Summary

| Phase | Plans | Status | Gaps |
|-------|-------|--------|------|
| 13 Foundation | 6/6 | Complete | ERR-06 partial (mapApiError unused) |
| 14 Social Features | 2/2 | Complete | COMM-01/02 broken (response shape), NOTIF-05 cosmetic |
| 15 Polish Completion | 3/3 | Complete | RESP-06 partial (MobileNav on 2/5 pages) |
