---
phase: 15-polish-completion
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/i18n/locales/en/common.json
  - frontend/src/i18n/locales/fr/common.json
  - backend/src/i18n/locales/en/common.json
  - backend/src/i18n/locales/fr/common.json
  - backend/src/services/email-service.ts
autonomous: true
requirements:
  - I18N-01
  - I18N-02

must_haves:
  truths:
    - "All new v1.1 UI surfaces display correct translations in both English and French with no missing keys"
    - "Password reset email arrives with correct subject and body in the recipient's configured language"
    - "Error pages (404, 500), profile page, notification center, and comment thread all use i18n keys"
    - "No hardcoded English strings remain in v1.1 components"
  artifacts:
    - path: "frontend/src/i18n/locales/en/common.json"
      provides: "Complete EN translations for all v1.1 surfaces"
      contains: "password_reset"
    - path: "frontend/src/i18n/locales/fr/common.json"
      provides: "Complete FR translations for all v1.1 surfaces"
      contains: "password_reset"
    - path: "backend/src/services/email-service.ts"
      provides: "Password reset email with locale-aware subject and body"
      contains: "sendPasswordReset"
    - path: "backend/src/i18n/locales/en/common.json"
      provides: "Backend EN translations including password reset email keys"
      contains: "password_reset"
    - path: "backend/src/i18n/locales/fr/common.json"
      provides: "Backend FR translations including password reset email keys"
      contains: "password_reset"
  key_links:
    - from: "backend/src/services/email-service.ts"
      to: "backend/src/i18n/locales/en/common.json"
      via: "tWithLang function for email subject/body"
      pattern: "tWithLang.*password_reset"
---

<objective>
Complete i18n for all new v1.1 UI surfaces and email templates so that every user-facing string displays correctly in both English and French.

Purpose: French-speaking users need the same complete experience as English-speaking users. Password reset emails must arrive in the correct language. Phase 13 and 14 will have created new pages (password reset, profile, error pages, notification center, comment thread) that need translation auditing.
Output: Complete EN/FR translation files for frontend and backend, locale-aware password reset email in email-service.ts.
</objective>

<execution_context>
@/Users/mmaudet/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mmaudet/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@frontend/src/i18n/locales/en/common.json
@frontend/src/i18n/locales/fr/common.json
@backend/src/i18n/locales/en/common.json
@backend/src/i18n/locales/fr/common.json
@backend/src/services/email-service.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and complete frontend i18n for all v1.1 surfaces</name>
  <files>
    frontend/src/i18n/locales/en/common.json
    frontend/src/i18n/locales/fr/common.json
  </files>
  <action>
Phase 13 and 14 will have created several new UI surfaces. This task audits all frontend pages and components for missing or hardcoded strings.

**Step 1: Identify all v1.1 pages and components that Phase 13-14 will create.**

Scan all .tsx files in `frontend/src/pages/` and `frontend/src/components/` for:
- Any `useTranslation()` calls with translation keys not present in EN/FR locale files
- Any hardcoded English/French strings in JSX (string literals in JSX that are NOT class names, IDs, or technical values)
- Focus especially on these new v1.1 surfaces (expected from Phases 13-14):
  - Password reset pages (request form, new password form)
  - Profile page (display name, password change, language preference)
  - Error pages (404, 500)
  - Notification center panel (bell dropdown)
  - Notification preferences (on profile page)
  - Comment thread component (on WorkflowDetailPage)
  - Form validation messages (inline errors)

**Step 2: For each missing key, add it to BOTH en/common.json and fr/common.json.**

Expected new key namespaces (add if not already present):

```
"password_reset": {
  "title": "Reset your password" / "Réinitialiser votre mot de passe",
  "email_label": "Email address" / "Adresse email",
  "send_link": "Send reset link" / "Envoyer le lien",
  "link_sent": "If this email exists, a reset link has been sent" / "Si cet email existe, un lien de réinitialisation a été envoyé",
  "new_password": "New password" / "Nouveau mot de passe",
  "confirm_password": "Confirm new password" / "Confirmer le nouveau mot de passe",
  "reset_button": "Reset password" / "Réinitialiser le mot de passe",
  "reset_success": "Password reset successfully. You can now log in." / "Mot de passe réinitialisé avec succès. Vous pouvez maintenant vous connecter.",
  "token_invalid": "This reset link is invalid or has expired" / "Ce lien de réinitialisation est invalide ou a expiré"
}

"profile": {
  "title": "My Profile" / "Mon profil",
  "display_name": "Display name" / "Nom d'affichage",
  "change_password": "Change password" / "Changer le mot de passe",
  "current_password": "Current password" / "Mot de passe actuel",
  "new_password": "New password" / "Nouveau mot de passe",
  "language": "Language" / "Langue",
  "save_success": "Profile updated" / "Profil mis à jour",
  "password_changed": "Password changed successfully" / "Mot de passe changé avec succès"
}

"errors": {
  "not_found": (already exists),
  "not_found_message": "The page you're looking for doesn't exist." / "La page que vous recherchez n'existe pas.",
  "go_home": "Go to dashboard" / "Aller au tableau de bord",
  "server_error": "Something went wrong" / "Une erreur s'est produite",
  "server_error_message": "We're having trouble. Please try again later." / "Nous rencontrons un problème. Veuillez réessayer plus tard.",
  "try_again": "Try again" / "Réessayer"
}

"notifications": {
  "title": "Notifications" / "Notifications",
  "mark_all_read": "Mark all as read" / "Tout marquer comme lu",
  "mark_read": "Mark as read" / "Marquer comme lu",
  "no_notifications": "No notifications" / "Aucune notification",
  "view_workflow": "View workflow" / "Voir le circuit"
}

"notification_preferences": {
  "title": "Notification preferences" / "Préférences de notification",
  "action_taken": "When a validator acts" / "Quand un validateur agit",
  "workflow_complete": "When a workflow completes" / "Quand un circuit est terminé",
  "comment_added": "When a comment is added" / "Quand un commentaire est ajouté"
}

"comments": {
  "title": "Comments" / "Commentaires",
  "placeholder": "Write a comment..." / "Écrire un commentaire...",
  "send": "Send" / "Envoyer",
  "no_comments": "No comments yet" / "Aucun commentaire",
  "disabled_terminal": "Comments are disabled on completed workflows" / "Les commentaires sont désactivés sur les circuits terminés"
}

"validation": {
  "required": "This field is required" / "Ce champ est requis",
  "email_invalid": "Please enter a valid email" / "Veuillez entrer un email valide",
  "password_min": "Password must be at least {{min}} characters" / "Le mot de passe doit contenir au moins {{min}} caractères",
  "password_mismatch": "Passwords do not match" / "Les mots de passe ne correspondent pas",
  "name_min": "Name must be at least {{min}} characters" / "Le nom doit contenir au moins {{min}} caractères"
}

"nav": {
  ... (existing keys),
  "menu": "Menu" / "Menu",
  "profile": "Profile" / "Profil",
  "notifications": "Notifications" / "Notifications"
}
```

**Step 3: Audit hardcoded strings in existing v1.0 code.**

Known hardcoded strings to fix:
- `AdminUsersPage.tsx` line 260: `Actions` column header — should use `t('admin.column_actions')` — add this key.
- `DashboardPage.tsx` UsersTab: same `Actions` hardcoded — add key.
- `StepDetail.tsx` line 85: Hardcoded `'Quorum'` label — should use `t('workflow.quorum_label')` — add this key.

Add the necessary keys: `admin.column_actions` (EN: "Actions", FR: "Actions"), `workflow.quorum_label` (EN: "Quorum", FR: "Quorum").

**Important:** Only ADD new keys. Do NOT modify or remove existing keys (other plans may depend on them). Maintain alphabetical ordering within each namespace.
  </action>
  <verify>
Run a grep across all frontend .tsx files for string patterns that look like hardcoded user-facing text: `grep -rn ">[A-Z][a-z]" frontend/src/pages/ frontend/src/components/ | grep -v className | grep -v import | grep -v '//'` — verify no obvious missing translations.
Verify both EN and FR JSON files are valid JSON: `node -e "JSON.parse(require('fs').readFileSync('frontend/src/i18n/locales/en/common.json'))"` and same for FR.
Verify key counts match between EN and FR files.
  </verify>
  <done>
Both EN and FR locale files contain all keys needed for v1.1 surfaces: password reset, profile, error pages, notifications, comments, form validation, and navigation. No hardcoded user-facing strings remain in v1.1 components. Key counts match between EN and FR.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add password reset email template with FR/EN support</name>
  <files>
    backend/src/services/email-service.ts
    backend/src/i18n/locales/en/common.json
    backend/src/i18n/locales/fr/common.json
  </files>
  <action>
Phase 13 will have created the password reset flow (AUTH-01 through AUTH-05). This task ensures the password reset email has proper i18n in the email service.

**Step 1: Check if `sendPasswordReset` already exists in email-service.ts.**

If Phase 13 already added it, audit the existing implementation for:
- Locale-aware subject line using `tWithLang(locale, 'email.password_reset_subject', ...)`
- Locale-aware body text (not hardcoded English/French ternary — use i18n keys)
- Consistent HTML structure matching existing email templates

If Phase 13 did NOT add it (unlikely but possible), create it:

Add to `email-service.ts`:

```typescript
export interface PasswordResetEmailInput {
  to: string;
  locale: string;
  resetUrl: string;
  userName: string;
}
```

Add `sendPasswordReset` method to `emailService` object:
- Uses `tWithLang(input.locale, ...)` for all text
- Subject: Uses `email.password_reset_subject` key
- Body HTML (same style as existing templates):
  - Greeting with user name
  - Explanation that a password reset was requested
  - CTA button linking to resetUrl (blue, centered, 12px/32px padding)
  - Note: link expires in X hours
  - Warning: if you didn't request this, ignore the email

**Step 2: Add backend i18n keys for password reset email.**

Add to `backend/src/i18n/locales/en/common.json` under `"email"`:
```json
"password_reset_subject": "Reset your password — {{appName}}",
"password_reset_greeting": "Hello {{userName}},",
"password_reset_body": "We received a request to reset your password. Click the button below to set a new password.",
"password_reset_button": "Reset my password",
"password_reset_expiry": "This link will expire in 1 hour.",
"password_reset_ignore": "If you didn't request this, you can safely ignore this email."
```

Add to `backend/src/i18n/locales/fr/common.json` under `"email"`:
```json
"password_reset_subject": "Réinitialisation de mot de passe — {{appName}}",
"password_reset_greeting": "Bonjour {{userName}},",
"password_reset_body": "Nous avons reçu une demande de réinitialisation de votre mot de passe. Cliquez sur le bouton ci-dessous pour définir un nouveau mot de passe.",
"password_reset_button": "Réinitialiser mon mot de passe",
"password_reset_expiry": "Ce lien expirera dans 1 heure.",
"password_reset_ignore": "Si vous n'avez pas fait cette demande, vous pouvez ignorer cet email."
```

**Step 3: Verify the email template uses i18n keys consistently.**

Replace any hardcoded `input.locale === 'fr' ? '...' : '...'` patterns in the password reset email with `t('email.password_reset_...')` calls, matching the pattern used in `sendPendingAction` and other existing methods.

NOTE: The existing email templates (sendPendingAction, sendReminder, etc.) use inline ternary for body text but tWithLang for subjects. For password reset, use tWithLang for BOTH subject and body text to be consistent with the i18n requirement. This is the v1.1 standard — existing templates can be updated later if desired but are out of scope.
  </action>
  <verify>
Run `npx tsc --noEmit` from the backend directory — no type errors.
Verify both backend locale JSON files are valid JSON.
Check that `sendPasswordReset` method exists in email-service.ts and uses `tWithLang` for subject and body text.
  </verify>
  <done>
Password reset email template exists in email-service.ts with full FR/EN support via i18n keys. Backend locale files contain all password_reset email keys in both languages. Email subject and body render in the recipient's configured language.
  </done>
</task>

</tasks>

<verification>
1. Frontend EN and FR locale files have matching key sets (no missing keys)
2. Backend EN and FR locale files have password_reset email keys
3. email-service.ts has sendPasswordReset using tWithLang for locale-aware content
4. No hardcoded user-facing strings in v1.1 components
5. Both `npx tsc --noEmit` passes (frontend and backend)
</verification>

<success_criteria>
- All new v1.1 UI surfaces (password reset, profile, error pages, notifications, comments, form validation) have complete EN and FR translations
- Password reset email arrives with correct subject and body in the recipient's language
- No missing i18n keys — switching language in the UI shows correct translations everywhere
- Backend and frontend JSON locale files are valid and keys match between EN and FR
</success_criteria>

<output>
After completion, create `.planning/phases/15-polish-completion/15-03-SUMMARY.md`
</output>
