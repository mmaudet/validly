---
phase: 13-foundation
plan: 06
type: execute
wave: 3
depends_on:
  - 13-03
  - 13-04
  - 13-05
files_modified:
  - frontend/src/lib/validation.ts
  - frontend/src/pages/LoginPage.tsx
  - frontend/src/pages/SignupPage.tsx
  - frontend/src/pages/ForgotPasswordPage.tsx
  - frontend/src/pages/ResetPasswordPage.tsx
  - frontend/src/pages/ProfilePage.tsx
  - frontend/src/pages/ActionConfirmPage.tsx
autonomous: true
requirements:
  - ERR-04
  - ERR-05
  - RESP-01
  - RESP-02

must_haves:
  truths:
    - "All forms show inline per-field validation errors before submission reaches the server"
    - "Zod schemas validate email format, password length, name length, and password confirmation"
    - "LoginPage and SignupPage are fully usable on mobile (375px+)"
    - "ActionConfirmPage is fully usable on mobile (375px+)"
    - "Touch targets on all form buttons are at least 44x44px"
  artifacts:
    - path: "frontend/src/lib/validation.ts"
      provides: "Shared Zod schemas for all forms"
      contains: "loginSchema"
    - path: "frontend/src/pages/LoginPage.tsx"
      provides: "Login form with Zod validation and mobile-responsive layout"
      contains: "zodResolver"
    - path: "frontend/src/pages/SignupPage.tsx"
      provides: "Signup form with Zod validation and mobile-responsive layout"
      contains: "zodResolver"
  key_links:
    - from: "frontend/src/pages/LoginPage.tsx"
      to: "frontend/src/lib/validation.ts"
      via: "import loginSchema"
      pattern: "loginSchema"
    - from: "frontend/src/pages/SignupPage.tsx"
      to: "frontend/src/lib/validation.ts"
      via: "import signupSchema"
      pattern: "signupSchema"
    - from: "frontend/src/lib/validation.ts"
      to: "zod"
      via: "z.object schema definitions"
      pattern: "z\\.object"
---

<objective>
Add Zod form validation with inline per-field errors to all forms (existing and new) and make login, signup, and ActionConfirmPage mobile-responsive at 375px+.

Purpose: Forms currently rely only on HTML5 validation (required, type="email") which gives poor UX -- browser-native popups, no inline messages, inconsistent across browsers. Zod provides consistent per-field error messages shown inline. Mobile responsiveness ensures critical auth and action pages work on phones.
Output: All forms use react-hook-form + Zod with inline errors. Login/signup/action pages responsive at 375px.
</objective>

<execution_context>
@/Users/mmaudet/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mmaudet/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@frontend/src/pages/LoginPage.tsx
@frontend/src/pages/SignupPage.tsx
@frontend/src/pages/ActionConfirmPage.tsx
@frontend/src/lib/api.ts
@.planning/phases/13-foundation/13-03-SUMMARY.md
@.planning/phases/13-foundation/13-04-SUMMARY.md
@.planning/phases/13-foundation/13-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared Zod schemas and refactor forms to use react-hook-form + Zod</name>
  <files>frontend/src/lib/validation.ts, frontend/src/pages/LoginPage.tsx, frontend/src/pages/SignupPage.tsx, frontend/src/pages/ForgotPasswordPage.tsx, frontend/src/pages/ResetPasswordPage.tsx, frontend/src/pages/ProfilePage.tsx</files>
  <action>
**Create validation.ts with shared Zod schemas:**

Create `frontend/src/lib/validation.ts`:

```typescript
import { z } from 'zod';

export const loginSchema = z.object({
  email: z.string().min(1, 'auth.email_required').email('auth.email_invalid'),
  password: z.string().min(1, 'auth.password_required'),
});
export type LoginForm = z.infer<typeof loginSchema>;

export const signupSchema = z.object({
  name: z.string().min(1, 'auth.name_required').max(100, 'auth.name_too_long'),
  email: z.string().min(1, 'auth.email_required').email('auth.email_invalid'),
  password: z.string().min(8, 'auth.password_min_length'),
  confirmPassword: z.string().min(1, 'auth.confirm_password_required'),
}).refine(data => data.password === data.confirmPassword, {
  message: 'auth.password_mismatch',
  path: ['confirmPassword'],
});
export type SignupForm = z.infer<typeof signupSchema>;

export const forgotPasswordSchema = z.object({
  email: z.string().min(1, 'auth.email_required').email('auth.email_invalid'),
});
export type ForgotPasswordForm = z.infer<typeof forgotPasswordSchema>;

export const resetPasswordSchema = z.object({
  password: z.string().min(8, 'auth.password_min_length'),
  confirmPassword: z.string().min(1, 'auth.confirm_password_required'),
}).refine(data => data.password === data.confirmPassword, {
  message: 'auth.password_mismatch',
  path: ['confirmPassword'],
});
export type ResetPasswordForm = z.infer<typeof resetPasswordSchema>;

export const changePasswordSchema = z.object({
  currentPassword: z.string().min(1, 'profile.current_password_required'),
  newPassword: z.string().min(8, 'auth.password_min_length'),
  confirmPassword: z.string().min(1, 'auth.confirm_password_required'),
}).refine(data => data.newPassword === data.confirmPassword, {
  message: 'auth.password_mismatch',
  path: ['confirmPassword'],
});
export type ChangePasswordForm = z.infer<typeof changePasswordSchema>;

export const profileNameSchema = z.object({
  name: z.string().min(1, 'auth.name_required').max(100, 'auth.name_too_long'),
});
export type ProfileNameForm = z.infer<typeof profileNameSchema>;
```

Error messages are i18n keys. Components use `t(error.message)` to display translated text.

**Refactor LoginPage.tsx:**

Convert from useState to react-hook-form + Zod:
- Import: `import { useForm } from 'react-hook-form'; import { zodResolver } from '@hookform/resolvers/zod'; import { loginSchema, LoginForm } from '../lib/validation';`
- Replace state variables with: `const { register, handleSubmit, formState: { errors } } = useForm<LoginForm>({ resolver: zodResolver(loginSchema) });`
- Replace `<input value={email} onChange=...>` with `<input {...register('email')} ...>`
- Add inline error display below each field: `{errors.email && <p className="mt-1 text-sm text-red-600">{t(errors.email.message!)}</p>}`
- Remove manual state (email, password useState), keep error and loading state for API errors.
- Keep the `handleSubmit` wrapper that calls `login(data.email, data.password)`.

**Refactor SignupPage.tsx:**

Same pattern as LoginPage but with signupSchema. Four fields: name, email, password, confirmPassword. Remove manual password match check (Zod handles it). Add inline error for each field.

**Refactor ForgotPasswordPage.tsx (created in Plan 03):**

Apply forgotPasswordSchema with zodResolver. Single email field with inline error.

**Refactor ResetPasswordPage.tsx (created in Plan 03):**

Apply resetPasswordSchema. Two password fields with inline errors.

**Refactor ProfilePage.tsx (created in Plan 04):**

Apply profileNameSchema to the name edit form. Apply changePasswordSchema to the password change form. Each form section gets its own useForm instance. Inline errors on all fields.

**Inline error component pattern** (use consistently across all forms):
```tsx
{errors.fieldName && (
  <p className="mt-1 text-sm text-red-600">{t(errors.fieldName.message!)}</p>
)}
```

**Add i18n keys for validation messages** to both EN and FR locale files:

EN additions to `auth` section:
```json
"email_required": "Email is required",
"email_invalid": "Please enter a valid email address",
"password_required": "Password is required",
"password_min_length": "Password must be at least 8 characters",
"name_required": "Name is required",
"name_too_long": "Name must be 100 characters or less",
"confirm_password_required": "Please confirm your password"
```

FR additions to `auth` section:
```json
"email_required": "L'email est requis",
"email_invalid": "Veuillez entrer une adresse email valide",
"password_required": "Le mot de passe est requis",
"password_min_length": "Le mot de passe doit faire au moins 8 caracteres",
"name_required": "Le nom est requis",
"name_too_long": "Le nom ne doit pas depasser 100 caracteres",
"confirm_password_required": "Veuillez confirmer votre mot de passe"
```

Add to `profile` section in EN: `"current_password_required": "Current password is required"`
Add to `profile` section in FR: `"current_password_required": "Le mot de passe actuel est requis"`
  </action>
  <verify>
1. `cd /Users/mmaudet/work/validly/frontend && npm run build` -- build succeeds
2. Grep validation.ts for `z.object` -- confirms Zod schemas
3. Grep LoginPage.tsx for `zodResolver` -- confirms Zod integration
4. Grep SignupPage.tsx for `zodResolver` -- confirms Zod integration
5. Grep LoginPage.tsx for `errors.email` -- confirms inline error display
  </verify>
  <done>All six forms use react-hook-form + Zod with inline per-field validation errors. Validation schemas centralized in validation.ts. Error messages use i18n keys translated EN/FR.</done>
</task>

<task type="auto">
  <name>Task 2: Make login, signup, and ActionConfirmPage mobile-responsive</name>
  <files>frontend/src/pages/LoginPage.tsx, frontend/src/pages/SignupPage.tsx, frontend/src/pages/ActionConfirmPage.tsx</files>
  <action>
**Mobile responsiveness requirements:**
- All three pages must be fully usable at 375px width (iPhone SE)
- Touch targets must be at least 44x44px (buttons, links, inputs)
- No horizontal scroll at 375px
- Text readable without zooming

**LoginPage.tsx (RESP-02):**

The existing layout is already mostly responsive (flex, min-h-screen, items-center, px-4, max-w-md). Audit and fix:
1. Ensure `px-4` on outermost container (already present) -- provides 16px gutter on mobile.
2. Ensure form inputs have `min-h-[44px]` or `py-2.5` (current `py-2` = 40px, bump to `py-2.5` for 44px touch target).
3. Ensure submit button has `min-h-[44px]` (current `px-4 py-2` might be short -- add `py-3` or `min-h-[44px]`).
4. Ensure the "Don't have an account?" / "Forgot password?" links have adequate tap area. Wrap in a div with `py-2` padding if needed, or use `inline-block py-2` on the links themselves.
5. Logo image: ensure `h-16 sm:h-24` so it's smaller on mobile.
6. Title text: ensure `text-2xl sm:text-3xl` for mobile.

**SignupPage.tsx (RESP-02):**

Same fixes as LoginPage. Additionally:
1. Ensure the form width doesn't overflow at 375px (max-w-md = 448px which is fine with px-4 padding).
2. All four inputs need 44px touch targets.
3. Submit button needs 44px height.

**ActionConfirmPage.tsx (RESP-01):**

The existing layout uses `max-w-lg` which is 512px -- at 375px with px-4 padding this gives ~343px content width. Audit and fix:
1. Change the summary grid from `grid-cols-2` to `grid-cols-1 sm:grid-cols-2` so labels and values stack on mobile.
2. Ensure textarea has full width (already `w-full`).
3. Ensure submit button has `min-h-[44px]` and full width.
4. Comment textarea: ensure adequate touch target for focus.
5. Logo: `h-16 sm:h-24` on mobile.
6. Title: `text-2xl sm:text-3xl`.
7. Ensure the loading skeleton and token error states are also responsive.

**General pattern for all three pages:**
- Inputs: `px-3 py-2.5` (gives ~44px height with border)
- Buttons: `px-4 py-3` or explicit `min-h-[44px]`
- Links: wrap with padding for tap targets, or use `inline-block py-2`
- Logo: `h-16 sm:h-24`
- Container: keep existing `px-4` for mobile gutters
  </action>
  <verify>
1. `cd /Users/mmaudet/work/validly/frontend && npm run build` -- build succeeds
2. Grep LoginPage.tsx for `min-h-\[44px\]` or `py-2.5` or `py-3` -- confirms touch targets
3. Grep ActionConfirmPage.tsx for `sm:grid-cols-2` -- confirms responsive grid
  </verify>
  <done>LoginPage, SignupPage, and ActionConfirmPage are fully usable at 375px width. All touch targets are 44px+. Summary grid stacks on mobile. Text is readable without zooming.</done>
</task>

</tasks>

<verification>
1. Frontend builds: `cd /Users/mmaudet/work/validly/frontend && npm run build`
2. All forms use Zod validation with inline errors
3. Login and signup pages have responsive adjustments for 375px
4. ActionConfirmPage summary grid responsive
5. All button touch targets >= 44px
</verification>

<success_criteria>
- All forms (login, signup, forgot password, reset password, profile name, profile password change) show inline per-field Zod validation errors
- Validation happens before form submission (client-side)
- LoginPage and SignupPage fully usable at 375px width
- ActionConfirmPage fully usable at 375px width
- All interactive elements have 44px+ touch targets
- Frontend build passes
</success_criteria>

<output>
After completion, create `.planning/phases/13-foundation/13-06-SUMMARY.md`
</output>
