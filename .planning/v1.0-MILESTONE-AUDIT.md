---
milestone: v1.0
audited: 2026-02-19
status: gaps_found
scores:
  requirements: 34/41
  phases: 10/10
  integration: 15/15
  flows: 7/10
gaps:
  requirements:
    - id: "WF-02"
      status: "partial"
      phase: "Phase 4"
      description: "PARALLEL execution mode stored but not enforced — all steps activate sequentially"
      evidence: "workflow-service.ts launch() only activates first step; tryAdvance() activates next PENDING step one at a time regardless of execution mode"
    - id: "WF-08"
      status: "partial"
      phase: "Phase 7"
      description: "Template execution field mismatch — frontend expects 'executionMode', backend returns 'execution'"
      evidence: "TemplatePicker.tsx declares step.executionMode but backend template JSON uses 'execution'; templateStructureToForm() gets undefined"
    - id: "EMAIL-06"
      status: "partial"
      phase: "Phase 5"
      description: "Validator email locale hardcoded to 'fr' — EN users receive French emails"
      evidence: "workflow-service.ts lines 49, 712 and reminder-worker.ts line 66 all use locale: 'fr'"
    - id: "INFRA-05"
      status: "partial"
      phase: "Phase 8"
      description: "Email templates localized but validator locale not resolved at send time"
      evidence: "Same root cause as EMAIL-06 — validator User.locale never queried"
    - id: "AUDIT-02"
      status: "unsatisfied"
      phase: "Phase 2"
      description: "INSERT-only enforcement at DB level not implemented — application-layer only"
      evidence: "No PostgreSQL trigger or RLS policy in migrations for audit_events table"
    - id: "TMPL-01"
      status: "partial"
      phase: "Phase 7"
      description: "No frontend UI to create workflow templates — backend API only"
      evidence: "POST/PUT/DELETE /templates routes exist but no TemplatePage.tsx or create form in frontend"
    - id: "TMPL-02"
      status: "partial"
      phase: "Phase 7"
      description: "No frontend form for template creation — backend schema validation exists"
      evidence: "TemplatePicker.tsx only calls GET /templates; no create/edit UI"
  integration:
    - from: "Phase 7 (Templates)"
      to: "Phase 9 (Wizard)"
      issue: "execution field name mismatch between backend template JSON and frontend TemplatePicker type"
    - from: "Phase 4 (Engine)"
      to: "Phase 5 (Email)"
      issue: "Validator locale not resolved — emails always sent in French"
  flows:
    - name: "Template-based workflow creation"
      breaks_at: "Template loading into circuit builder — executionMode field is undefined"
    - name: "Parallel step execution"
      breaks_at: "Workflow launch — only first step activated regardless of execution mode"
    - name: "EN validator email flow"
      breaks_at: "Email send — locale hardcoded to 'fr'"
tech_debt:
  - phase: "schema"
    items:
      - "ARCHIVED status not in domain WorkflowStatus type (workflow-types.ts) — archive bypasses state machine"
      - "WorkflowAction.comment nullable in schema but required by all routes at application layer"
  - phase: "10-ux-improvements"
    items:
      - "Phase 10 plans 10-03 through 10-05 marked unchecked in ROADMAP.md but have SUMMARY.md files"
      - "REQUIREMENTS.md traceability table all marked Pending — never updated during development"
---

# Milestone v1.0 Audit Report

## Summary

**Status:** gaps_found
**Requirements:** 34/41 satisfied (7 gaps)
**Phases:** 10/10 complete (all have code shipped)
**Integration:** 15/15 API routes properly wired
**E2E Flows:** 7/10 complete (3 breaks)

## Critical Gaps

### 1. WF-02 — Parallel Step Execution Not Enforced

**Severity:** Medium
**Phase:** 4 (Workflow Engine)

The `execution: 'PARALLEL'` mode is stored on steps but never enforced. At workflow launch, only the first step is activated. `tryAdvance()` activates the next PENDING step sequentially regardless of execution mode. Parallel steps behave identically to sequential ones.

**Fix:** In `launch()`, activate all steps in a phase when any step has `execution: 'PARALLEL'`. In `tryAdvance()`, check sibling step execution mode before sequential activation.

### 2. WF-08 / TMPL-04 — Template Execution Field Mismatch

**Severity:** Medium
**Phase:** 7 → 9 cross-phase

`TemplatePicker.tsx` declares `step.executionMode` but backend template JSON stores `execution`. When loading a template into the circuit builder, `executionMode` is always `undefined`.

**Fix:** Align `TemplatePicker` type to use `execution` matching the backend `WorkflowStructure.StepStructure`.

### 3. EMAIL-06 / INFRA-05 — Validator Email Locale Hardcoded

**Severity:** Low
**Phase:** 5 (Email) + 8 (i18n)

`notifyValidators()`, `notifyCurrentStep()`, and `reminder-worker.ts` all use `locale: 'fr'` instead of resolving the validator's actual locale from their User record.

**Fix:** Query validator User.locale before sending, or pass locale through the notification context.

### 4. AUDIT-02 — No DB-Level INSERT-Only Enforcement

**Severity:** Medium
**Phase:** 2 (Data Model)

The `audit_events` table has no PostgreSQL trigger or RLS policy preventing UPDATE/DELETE. Immutability is enforced only at the application layer.

**Fix:** Add a migration with a PostgreSQL trigger: `CREATE RULE ... AS ON UPDATE TO audit_events DO INSTEAD NOTHING` (or equivalent).

### 5. TMPL-01 / TMPL-02 — No Template Creation UI

**Severity:** Low
**Phase:** 7 (Templates)

Backend CRUD routes exist but the frontend has no page to create or edit templates. Users can only load existing templates in the wizard via `TemplatePicker`.

**Fix:** Add a template management page or integrate save-as-template in the wizard review step.

## E2E Flow Status

| Flow | Status | Issue |
|------|--------|-------|
| User Signup | COMPLETE | — |
| User Login + JWT Refresh | COMPLETE | — |
| User Logout | COMPLETE | — |
| Document Upload + Workflow Launch | COMPLETE | — |
| Email Action + Token | COMPLETE | — |
| Expired/Invalid Token Error | COMPLETE | — |
| Dashboard Views | COMPLETE | — |
| Audit Trail + CSV Export | COMPLETE | — |
| Template-Based Workflow | BROKEN | execution field mismatch |
| Parallel Step Execution | BROKEN | steps activate sequentially |
| EN Validator Emails | BROKEN | locale hardcoded to 'fr' |

## Requirements Coverage

| Req | Description | Status | Notes |
|-----|-------------|--------|-------|
| AUTH-01 | Signup with email/password | Satisfied | — |
| AUTH-02 | Login + JWT token | Satisfied | — |
| AUTH-03 | Session persists (JWT refresh) | Satisfied | — |
| AUTH-04 | Logout | Satisfied | — |
| AUTH-05 | Role distinction | Satisfied | ADMIN/INITIATEUR/VALIDATEUR |
| DOC-01 | Upload documents with metadata | Satisfied | — |
| DOC-02 | StorageAdapter abstraction | Satisfied | LocalStorageAdapter, swappable |
| DOC-03 | PDF preview (PDF.js) | Satisfied | react-pdf in DocumentPreview |
| DOC-04 | Image preview inline | Satisfied | blob URL in DocumentPreview |
| DOC-05 | Document metadata in DB | Satisfied | — |
| WF-01 | Launch workflow | Satisfied | — |
| WF-02 | Sequential + parallel steps | **Gap** | Parallel not enforced |
| WF-03 | Quorum rules | Satisfied | unanimity/majority/any-of |
| WF-04 | Approve/refuse with comment | Satisfied | — |
| WF-05 | Refusal routes back | Satisfied | — |
| WF-06 | Optional deadline | Satisfied | — |
| WF-07 | State machine transitions | Satisfied | — |
| WF-08 | Deep copy from template | **Gap** | execution field mismatch |
| EMAIL-01 | Validator email notification | Satisfied | — |
| EMAIL-02 | Secure token links | Satisfied | — |
| EMAIL-03 | CSPRNG tokens | Satisfied | — |
| EMAIL-04 | Error pages for bad tokens | Satisfied | — |
| EMAIL-05 | Automated reminders | Satisfied | — |
| EMAIL-06 | Email localized EN+FR | **Gap** | Hardcoded to 'fr' |
| DASH-01 | My submissions view | Satisfied | — |
| DASH-02 | My pending actions view | Satisfied | — |
| DASH-03 | Workflow visualization | Satisfied | Stepper + StepDetail |
| DASH-04 | Paginated views | Satisfied | — |
| AUDIT-01 | Immutable audit trail | Satisfied | — |
| AUDIT-02 | INSERT-only at DB level | **Gap** | Application-layer only |
| AUDIT-03 | CSV export | Satisfied | — |
| TMPL-01 | Create templates | **Gap** | No frontend UI |
| TMPL-02 | Form-based creation | **Gap** | No frontend form |
| TMPL-03 | Org-level sharing | Satisfied | isShared flag works |
| TMPL-04 | Deep copy on launch | Satisfied | JSON deep copy works |
| INFRA-01 | Docker Compose | Satisfied | — |
| INFRA-02 | OpenAPI spec | Satisfied | — |
| INFRA-03 | Swagger UI | Satisfied | — |
| INFRA-04 | UI localized EN+FR | Satisfied | — |
| INFRA-05 | Email templates EN+FR | **Gap** | Locale not resolved |
| INFRA-06 | i18n from start | Satisfied | — |

## Tech Debt

- `ARCHIVED` status not in domain `WorkflowStatus` type — archive bypasses state machine
- `WorkflowAction.comment` nullable in schema but required by all routes
- ROADMAP.md plans 10-03 through 10-05 checkboxes not updated
- REQUIREMENTS.md traceability table never updated from Pending status
