---
phase: 12-template-management-ui
plan: 02
type: execute
wave: 2
depends_on:
  - "12-01"
files_modified:
  - frontend/src/pages/DashboardPage.tsx
autonomous: false
requirements:
  - TMPL-01
  - TMPL-02

must_haves:
  truths:
    - "User sees a Templates tab on the dashboard"
    - "Templates tab lists all templates with name, description, and action buttons"
    - "User can click Edit to navigate to /templates/:id/edit"
    - "User can click Delete and confirm to delete a template via DELETE /templates/:id"
    - "User can click New Template button to navigate to /templates/new"
    - "Empty state shows a message when no templates exist"
  artifacts:
    - path: "frontend/src/pages/DashboardPage.tsx"
      provides: "TemplatesTab component and templates tab button in tab bar"
      contains: "TemplatesTab"
  key_links:
    - from: "frontend/src/pages/DashboardPage.tsx (TemplatesTab)"
      to: "/templates"
      via: "useQuery with queryKey ['templates'] for listing"
      pattern: "queryKey.*templates"
    - from: "frontend/src/pages/DashboardPage.tsx (TemplatesTab)"
      to: "/templates/:id"
      via: "apiFetch DELETE mutation for deletion"
      pattern: "method.*DELETE"
    - from: "frontend/src/pages/DashboardPage.tsx (TemplatesTab)"
      to: "frontend/src/pages/TemplateFormPage.tsx"
      via: "navigate('/templates/:id/edit') on Edit button click"
      pattern: "navigate.*templates.*edit"
---

<objective>
Add a TemplatesTab to the DashboardPage so users can view, create, edit, and delete templates from the dashboard — completing the template management UI accessible from the main navigation.

Purpose: Templates must be accessible from the dashboard (Success Criteria #4 from ROADMAP). This plan wires the TemplatesTab into the existing dashboard tab system, following the exact pattern of the UsersTab.
Output: Updated DashboardPage.tsx with TemplatesTab component and tab button
</objective>

<execution_context>
@/Users/mmaudet/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mmaudet/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-template-management-ui/12-RESEARCH.md
@.planning/phases/12-template-management-ui/12-01-SUMMARY.md

@frontend/src/pages/DashboardPage.tsx
@frontend/src/components/workflow/TemplatePicker.tsx
@frontend/src/components/ui/ConfirmDialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add TemplatesTab component and wire into DashboardPage tabs</name>
  <files>frontend/src/pages/DashboardPage.tsx</files>
  <action>
**Step 1: Extend the Tab type**

Change:
```typescript
type Tab = 'submissions' | 'pending' | 'users';
```
To:
```typescript
type Tab = 'submissions' | 'pending' | 'users' | 'templates';
```

**Step 2: Add templates tab button in the tab bar**

After the existing Users tab button (the `{isAdmin && ( ... )}` block), add a new tab button for templates. This tab is visible to ALL authenticated users (not admin-only, unlike Users tab). Place it between the Pending tab and the Users tab:

```tsx
<button
  onClick={() => handleTabChange('templates')}
  className={`relative flex items-center gap-2 px-6 py-3 text-sm font-medium transition border-b-2 -mb-px ${
    tab === 'templates'
      ? 'border-blue-600 text-blue-600'
      : 'border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300'
  }`}
>
  {t('nav.templates')}
</button>
```

Use the same blue styling as the submissions/pending tabs (not the purple admin styling). The `nav.templates` key already exists in both EN ("Templates") and FR ("Modeles") common.json files.

**Step 3: Add tab content rendering**

After the `{tab === 'users' && isAdmin && <UsersTab />}` line, add:
```tsx
{tab === 'templates' && <TemplatesTab />}
```

**Step 4: Create the TemplatesTab function component**

Define `TemplatesTab` as a function component at the bottom of DashboardPage.tsx (following the same pattern as `UsersTab`). Import `Template` type from `../components/workflow/TemplatePicker` at the top of the file and `ConfirmDialog` from `../components/ui/ConfirmDialog`.

Also import the `TemplateListResponse` interface or define it inline:
```typescript
interface TemplateListResponse {
  templates: Template[];
  total: number;
  page: number;
  limit: number;
  totalPages: number;
}
```

**TemplatesTab implementation:**

State:
- `const [deleteTemplate, setDeleteTemplate] = useState<Template | null>(null)`
- `const [deleteError, setDeleteError] = useState<string | null>(null)`

Query (same queryKey as TemplatePicker for shared cache):
```typescript
const { data, isLoading } = useQuery<TemplateListResponse>({
  queryKey: ['templates'],
  queryFn: () => apiFetch<TemplateListResponse>('/templates?limit=50'),
});
const templates = data?.templates ?? [];
```

Delete mutation:
```typescript
const deleteMutation = useMutation({
  mutationFn: (templateId: string) =>
    apiFetch<void>(`/templates/${templateId}`, { method: 'DELETE' }),
  onSuccess: () => {
    queryClient.invalidateQueries({ queryKey: ['templates'] });
    setDeleteTemplate(null);
    setDeleteError(null);
  },
  onError: (err: Error) => {
    if (err instanceof ApiError && err.status === 403) {
      setDeleteError(t('template.error_403'));
    } else {
      setDeleteError(err.message);
    }
    setDeleteTemplate(null);
  },
});
```

Render structure (following UsersTab pattern):
1. **Header row** with title `t('nav.templates')` (left) and "New Template" button (right) that navigates to `/templates/new` using `navigate('/templates/new')`. Button text: `t('template.create_button')`. Button style: same blue as the "New workflow" button (`bg-blue-600 hover:bg-blue-700 text-white`).

2. **Delete error banner** (if deleteError is set): red bg-red-50 text with error message, same pattern as UsersTab.

3. **Loading state**: Same skeleton pattern as UsersTab (5 rows of animated pulse divs).

4. **Empty state**: If not loading and templates.length === 0, show centered card with `t('template.no_templates')`.

5. **Templates table**: Same structure as UsersTab table.
   - Columns: Name (`t('template.column_name')`), Description (`t('template.column_description')`), Actions (`t('template.column_actions')`)
   - Each row: template name (font-medium), description (text-gray-600, truncated with `line-clamp-1`), Edit and Delete buttons
   - Edit button: `onClick={() => navigate('/templates/' + tpl.id + '/edit')}`, text-blue-600, text `t('template.edit')`
   - Delete button: `onClick={() => { setDeleteTemplate(tpl); setDeleteError(null); }}`, text-red-600, text `t('template.delete')`

6. **Delete confirmation**: Use the `ConfirmDialog` component (already imported from `../components/ui/ConfirmDialog`):
   ```tsx
   {deleteTemplate && (
     <ConfirmDialog
       title={t('template.delete_confirm_title')}
       message={t('template.delete_confirm_message')}
       variant="danger"
       onConfirm={() => { if (deleteTemplate) deleteMutation.mutate(deleteTemplate.id); }}
       onCancel={() => { setDeleteTemplate(null); setDeleteError(null); }}
     />
   )}
   ```
   Check the ConfirmDialog props interface in `components/ui/ConfirmDialog.tsx` before writing — match the exact prop names. If ConfirmDialog doesn't accept `variant`, use the pattern from UsersTab (inline modal with manual confirm/cancel buttons instead).

Note: `ApiError` is already imported at the top of DashboardPage.tsx. `useNavigate` and `useQueryClient` are already available in the DashboardPage component scope, but TemplatesTab is a separate function — it needs its own `useNavigate()`, `useQueryClient()`, and `useTranslation()` hooks, same as UsersTab does.
  </action>
  <verify>
Run `npx tsc --noEmit` from frontend directory — no type errors. Verify DashboardPage.tsx contains: Tab type includes 'templates', tab button with nav.templates, TemplatesTab function component, useQuery with queryKey ['templates'], delete mutation with cache invalidation, navigate to /templates/new and /templates/:id/edit.
  </verify>
  <done>
DashboardPage has a "Templates" tab visible to all authenticated users. The tab renders a table of templates with name, description, and Edit/Delete action buttons. "New Template" button navigates to /templates/new. Edit navigates to /templates/:id/edit. Delete shows confirmation dialog and calls DELETE /templates/:id. Empty state and loading skeleton are handled. TypeScript compiles.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: End-to-end verification of template management UI</name>
  <files>frontend/src/pages/DashboardPage.tsx</files>
  <action>
Human verification of the complete template management flow. All code was automated in Task 1 (this plan) and Plan 12-01. This checkpoint verifies the end-to-end user experience across both plans.
  </action>
  <verify>
1. Start the dev server: `cd frontend && npm run dev`
2. Log in and navigate to the Dashboard
3. Verify Templates tab exists: Click the "Templates" tab — should show empty state message
4. Create a template: Click "New Template" button — should navigate to /templates/new
   - Enter a template name (e.g. "Standard Legal Review")
   - Optionally enter a description
   - In the circuit builder, add a phase with a step — set a quorum rule, add validator emails
   - Click "Save Template" — should redirect to dashboard
5. Verify template appears: Click Templates tab — the created template should appear in the table
6. Edit a template: Click "Edit" on the template — should navigate to /templates/:id/edit with pre-populated form
   - Change the name or add a step
   - Click "Save Template" — should redirect to dashboard with updated data
7. Delete a template: Click "Delete" on the template — confirm dialog should appear
   - Click confirm — template should be removed from the list
8. Verify cache sync: Navigate to /workflows/new, open the template picker dropdown — deleted template should NOT appear, and any remaining templates should show correctly
  </verify>
  <done>
All template management flows work end-to-end: create, list, edit, delete. Templates tab shows on dashboard. TemplatePicker cache syncs with TemplatesTab. User types "approved" or describes issues.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npx tsc --noEmit` passes
2. DashboardPage Tab type includes 'templates'
3. TemplatesTab renders template list with CRUD actions
4. Templates tab uses same queryKey ['templates'] as TemplatePicker for cache sharing
5. Delete mutation invalidates ['templates'] query
6. Edit button navigates to /templates/:id/edit
7. New Template button navigates to /templates/new
8. End-to-end flow works: create -> list -> edit -> delete
</verification>

<success_criteria>
- Templates tab is visible on the dashboard for all authenticated users
- Table shows template name, description, and Edit/Delete action buttons
- "New Template" button navigates to /templates/new
- Edit button navigates to /templates/:id/edit
- Delete shows confirmation dialog and removes template on confirm
- Template list and TemplatePicker share cache (queryKey: ['templates'])
- 403 errors display user-friendly message
- Empty state message shown when no templates exist
</success_criteria>

<output>
After completion, create `.planning/phases/12-template-management-ui/12-02-SUMMARY.md`
</output>
